<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­–ç•¥æœåŠ¡æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #404040;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #6d28d9;
        }
        pre {
            background: #111;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ QuantConsole ç­–ç•¥æœåŠ¡æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ç¯å¢ƒå˜é‡æ£€æŸ¥</h2>
        <button onclick="checkEnvironment()">æ£€æŸ¥ç¯å¢ƒ</button>
        <pre id="env-result"></pre>
    </div>

    <div class="test-section">
        <h2>API Base URL æµ‹è¯•</h2>
        <button onclick="testApiConnection()">æµ‹è¯•è¿æ¥</button>
        <pre id="api-result"></pre>
    </div>

    <div class="test-section">
        <h2>ç­–ç•¥æœåŠ¡æµ‹è¯•</h2>
        <button onclick="testStrategyService()">æµ‹è¯•ç­–ç•¥æœåŠ¡</button>
        <pre id="strategy-result"></pre>
    </div>

    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'success' ? 'success' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : '';
            element.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
        }

        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function checkEnvironment() {
            clearLog('env-result');
            log('env-result', 'ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡...', 'info');
            
            try {
                // æ£€æŸ¥æ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒ
                const isDev = window.location.hostname === 'localhost';
                log('env-result', `å¼€å‘ç¯å¢ƒ: ${isDev}`, isDev ? 'success' : 'warning');
                
                // æ¨¡æ‹Ÿç¯å¢ƒå˜é‡æ£€æŸ¥
                const mockEnvVars = {
                    'VITE_API_BASE_URL': 'http://localhost:8080',
                    'VITE_WS_BASE_URL': 'ws://localhost:8080',
                    'VITE_APP_NAME': 'QuantConsole',
                    'VITE_ENVIRONMENT': 'development'
                };

                Object.entries(mockEnvVars).forEach(([key, value]) => {
                    log('env-result', `${key}: ${value}`, 'success');
                });

                log('env-result', 'âœ… ç¯å¢ƒæ£€æŸ¥å®Œæˆ', 'success');
            } catch (error) {
                log('env-result', `âŒ ç¯å¢ƒæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testApiConnection() {
            clearLog('api-result');
            log('api-result', 'ğŸŒ æµ‹è¯•APIè¿æ¥...', 'info');
            
            const apiBaseUrl = 'http://localhost:8080';
            
            try {
                log('api-result', `è¿æ¥ç›®æ ‡: ${apiBaseUrl}`, 'info');
                
                // å°è¯•è¿æ¥API
                const response = await fetch(`${apiBaseUrl}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    log('api-result', `âœ… APIè¿æ¥æˆåŠŸ: ${JSON.stringify(data)}`, 'success');
                } else {
                    log('api-result', `âš ï¸ APIå“åº”å¼‚å¸¸: ${response.status} ${response.statusText}`, 'warning');
                }
            } catch (error) {
                log('api-result', `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
                log('api-result', 'ğŸ’¡ è¿™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºåç«¯æœåŠ¡å¯èƒ½å°šæœªå¯åŠ¨', 'warning');
                log('api-result', 'ğŸ“‹ è¯·ç¡®ä¿åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:8080', 'info');
            }
        }

        async function testStrategyService() {
            clearLog('strategy-result');
            log('strategy-result', 'ğŸ¯ æµ‹è¯•ç­–ç•¥æœåŠ¡...', 'info');
            
            try {
                // æ¨¡æ‹Ÿç­–ç•¥æ•°æ®
                const mockStrategy = {
                    id: 'test-001',
                    name: 'æµ‹è¯•ç­–ç•¥',
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç­–ç•¥',
                    type: 'TECHNICAL',
                    status: 'DRAFT',
                    conditions: [
                        {
                            indicator: 'MA',
                            period: 20,
                            operator: 'GREATER_THAN',
                            value: 100
                        }
                    ]
                };

                log('strategy-result', 'ğŸ“Š æ¨¡æ‹Ÿç­–ç•¥æ•°æ®åˆ›å»º:', 'info');
                log('strategy-result', JSON.stringify(mockStrategy, null, 2), 'success');

                // æµ‹è¯•ç­–ç•¥éªŒè¯é€»è¾‘
                const isValidStrategy = mockStrategy.name && 
                                       mockStrategy.type && 
                                       mockStrategy.conditions && 
                                       mockStrategy.conditions.length > 0;

                log('strategy-result', `ç­–ç•¥éªŒè¯ç»“æœ: ${isValidStrategy ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}`, 
                    isValidStrategy ? 'success' : 'error');

                // æ¨¡æ‹ŸAPIè°ƒç”¨ï¼ˆå®é™…ä¼šè¿æ¥åç«¯ï¼‰
                log('strategy-result', 'ğŸ”„ æ¨¡æ‹ŸAPIè°ƒç”¨...', 'info');
                
                const apiCall = async () => {
                    // è¿™é‡Œåº”è¯¥è°ƒç”¨çœŸå®çš„ç­–ç•¥API
                    const apiBaseUrl = 'http://localhost:8080';
                    const response = await fetch(`${apiBaseUrl}/api/v1/strategies`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                            // 'Authorization': 'Bearer <token>'
                        },
                    });
                    
                    if (response.ok) {
                        return await response.json();
                    } else {
                        throw new Error(`APIè°ƒç”¨å¤±è´¥: ${response.status}`);
                    }
                };

                try {
                    const result = await apiCall();
                    log('strategy-result', 'âœ… ç­–ç•¥APIè°ƒç”¨æˆåŠŸ:', 'success');
                    log('strategy-result', JSON.stringify(result, null, 2), 'success');
                } catch (error) {
                    log('strategy-result', `âš ï¸ APIè°ƒç”¨å¤±è´¥: ${error.message}`, 'warning');
                    log('strategy-result', 'ğŸ’¡ è¿™æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºåç«¯å°šæœªå®ç°ç­–ç•¥API', 'info');
                }

                log('strategy-result', 'âœ… ç­–ç•¥æœåŠ¡æµ‹è¯•å®Œæˆ', 'success');
                
            } catch (error) {
                log('strategy-result', `âŒ ç­–ç•¥æœåŠ¡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç¯å¢ƒ
        window.addEventListener('load', () => {
            log('env-result', 'ğŸ¯ QuantConsole ç­–ç•¥æœåŠ¡æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
        });
    </script>
</body>
</html>
